<!DOCTYPE html>
<html lang="en" xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Product Catalog</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
</head>
<body>
    <div class="container py-4">
        <h1>Product Catalog</h1>
        
        <!-- Filters Section -->
        <div class="card mb-4">
            <div class="card-body">
                <h5>Filters</h5>
                <form method="get" action="/products" class="row g-3">
                    <div class="col-md-4">
                        <label for="search" class="form-label">Search</label>
                        <input type="text" class="form-control" id="search" name="q" 
                               th:value="${query}" placeholder="Search products...">
                    </div>
                    <div class="col-md-3">
                        <label for="category" class="form-label">Category</label>
                        <select class="form-select" id="category" name="category">
                            <option value="">All Categories</option>
                            <option th:each="cat : ${categories}" 
                                    th:value="${cat.id}" 
                                    th:text="${cat.name}"
                                    th:selected="${cat.id == selectedCategory}">
                            </option>
                        </select>
                    </div>
                    <div class="col-md-3">
                        <label for="brand" class="form-label">Brand</label>
                        <select class="form-select" id="brand" name="brand">
                            <option value="">All Brands</option>
                            <option th:each="brand : ${brands}" 
                                    th:value="${brand.id}" 
                                    th:text="${brand.name}"
                                    th:selected="${brand.id == selectedBrand}">
                            </option>
                        </select>
                    </div>
                    <div class="col-md-2 d-flex align-items-end">
                        <button type="submit" class="btn btn-primary">Filter</button>
                    </div>
                </form>
            </div>
        </div>
        
        <!-- Results Info -->
        <p class="text-muted mb-3">
            Showing <strong th:text="${products != null ? products.size() : 0}">0</strong> 
            of <strong th:text="${totalProducts ?: 0}">0</strong> products
        </p>
        
        <!-- Products Grid -->
        <div class="row">
            <div class="col-md-4 mb-4" th:each="product : ${products ?: {}}">
                <div class="card h-100">
                    <div class="card-body">
                        <h5 class="card-title" th:text="${product.title ?: 'No Title'}">Product Title</h5>
                        <p class="card-text" th:text="${product.description ?: 'No Description'}">Description</p>
                        <p class="card-text">
                            <strong th:text="'$' + ${product.price ?: 0}">$0.00</strong>
                        </p>
                        <p class="card-text" th:if="${product.brand}">
                            Brand: <span th:text="${product.brand.name}">Brand</span>
                        </p>
                        <a th:href="@{'/products/' + ${product.slug ?: 'unknown'}}" 
                           class="btn btn-primary">View Details</a>
                    </div>
                </div>
            </div>
        </div>
        
        <!-- No Products Message -->
        <div th:if="${products == null or #lists.isEmpty(products)}" class="text-center py-5">
            <h3>No products found</h3>
            <p>Try adjusting your search or filters.</p>
        </div>
        
        <!-- Pagination -->
        <nav th:if="${totalPages != null and totalPages > 1}" class="mt-4" aria-label="Product pagination">
            <ul class="pagination justify-content-center">
                <!-- Previous Button -->
                <li class="page-item" th:classappend="${currentPage == null or currentPage == 0} ? 'disabled'">
                    <a class="page-link" 
                       th:href="@{/products(page=${(currentPage ?: 0) - 1}, q=${query}, category=${selectedCategory}, brand=${selectedBrand})}"
                       aria-label="Previous">
                        <span aria-hidden="true">&laquo;</span>
                    </a>
                </li>
                
                <!-- Page Numbers -->
                <li th:each="page : ${#numbers.sequence(0, (totalPages ?: 1) - 1)}" 
                    class="page-item" 
                    th:classappend="${page == (currentPage ?: 0)} ? 'active'">
                    <a class="page-link" 
                       th:href="@{/products(page=${page}, q=${query}, category=${selectedCategory}, brand=${selectedBrand})}"
                       th:text="${page + 1}">1</a>
                </li>
                
                <!-- Next Button -->
                <li class="page-item" th:classappend="${currentPage == null or currentPage >= (totalPages ?: 1) - 1} ? 'disabled'">
                    <a class="page-link" 
                       th:href="@{/products(page=${(currentPage ?: 0) + 1}, q=${query}, category=${selectedCategory}, brand=${selectedBrand})}"
                       aria-label="Next">
                        <span aria-hidden="true">&raquo;</span>
                    </a>
                </li>
            </ul>
        </nav>
        
        <!-- Pagination Info -->
        <div th:if="${totalPages != null and totalPages > 1}" class="text-center mt-2">
            <small class="text-muted">
                Page <strong th:text="${(currentPage ?: 0) + 1}">1</strong> 
                of <strong th:text="${totalPages ?: 1}">1</strong>
            </small>
        </div>
        
        <!-- Debug Info -->
        <div class="mt-4 p-3 bg-light">
            <h6>Debug Info:</h6>
            <p>Products object: <span th:text="${products != null ? 'Available' : 'Null'}">Unknown</span></p>
            <p>Products size: <span th:text="${products != null ? products.size() : 'N/A'}">0</span></p>
            <p>Categories: <span th:text="${categories != null ? categories.size() : 'N/A'}">0</span></p>
            <p>Brands: <span th:text="${brands != null ? brands.size() : 'N/A'}">0</span></p>
            <p>Current Page: <span th:text="${currentPage ?: 'N/A'}">0</span></p>
            <p>Total Pages: <span th:text="${totalPages ?: 'N/A'}">0</span></p>
            <p>Total Products: <span th:text="${totalProducts ?: 'N/A'}">0</span></p>
        </div>
    </div>
    
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>
</body>
</html>
